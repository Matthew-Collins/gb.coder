' Gambas class file

Public RootFolder As String
Public ProjectFiles As New ProjectFile[]
Public Type As Integer

Public SwiftFolder As String = "/home/matthew/Downloads/swift-4.0-DEVELOPMENT-SNAPSHOT-2017-08-15-a-ubuntu16.04/usr/bin"

Public Exec As New Executor

Public Debugger As DebuggerLLDB

Public Sub _new()

  ' Dim ProjectFile As New ProjectFile(Me, "Program.vb", ProjectTypes.Vb)
  '
  ' Me.RootFolder = "/home/matthew/Documents/Core/MyFirstApp"
  ' Me.ProjectFiles.Add(ProjectFile)
  ' Me.Type = ProjectTypes.VbCore

  Dim ProjectFile As New ProjectFile(Me, "main.swift", ProjectTypes.SwiftScript)

  Me.RootFolder = "/home/matthew/Documents/Swift/MyFirstApp"
  Me.ProjectFiles.Add(ProjectFile)
  Me.Type = ProjectTypes.SwiftScript

  ' Dim ProjectFile As New ProjectFile(Me, "Main.module", ProjectTypes.GambasScript)
  '
  ' Me.RootFolder = "/home/matthew/Documents/Gambas/MyFirstApp"
  ' Me.ProjectFiles.Add(ProjectFile)
  ' Me.Type = ProjectTypes.GambasScript

End

Public Function GetFirstProjectFile() As ProjectFile

  Dim ProjectFile As ProjectFile

  For Each ProjectFile In Me.ProjectFiles
    Return ProjectFile
  Next

End

Public Sub Save()

  Dim ProjectFile As ProjectFile

  For Each ProjectFile In Me.ProjectFiles
    ProjectFile.Flush()
  Next

End

Public Sub Run()

  Dim Compiler As New String[]

  Me.Save()

  Select Case Me.Type
    Case ProjectTypes.VbCore
      Compiler.Add("dotnet")
      Compiler.Add("run")
      Compiler.Add("-p")
      Compiler.Add(RootFolder)

    Case ProjectTypes.SwiftScript
      Compiler.Add(SwiftFolder &/ "swift")
      Compiler.Add(rootfolder &/ "main.swift")

    Case ProjectTypes.GambasScript
      Compiler.Add("gbs3")
      Compiler.Add(rootfolder &/ "Main.module")

    Case Else
      Message.Error("No Compiler Configured for Project Type")

  End Select

  Exec.Execute(Compiler, Compiler, True, False, "")

End

Public Sub Debug()

  Dim Compiler As New String[]

  Me.Save()

  Select Case Me.Type
    Case ProjectTypes.SwiftScript

      Compiler.Add(SwiftFolder &/ "swiftc")
      Compiler.Add("-g")
      Compiler.Add(RootFolder &/ "main.swift")
      Compiler.Add("-o")
      Compiler.Add(RootFolder &/ "main")
      Exec.Execute(Compiler)

      Me.Debugger = New DebuggerLLDB(SwiftFolder, RootFolder &/ "main")
      Me.Debugger.SetBreakPoints("main.swift", [1])
      Me.Debugger.Run()

    Case Else
      Message.Error("No Debugger Configured for Project Type")

  End Select

End
