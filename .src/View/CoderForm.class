' Gambas class file

Public Project As New Project As "Project"
Public CodeCompleter As New CodeCompleter(Project)

Public FirstTab As Boolean = True

Public Sub _new()

  FormSettings.ApplySavedLocationAndSize(Me)

End

Public Sub Form_Open()

  Dim ProjectFile As ProjectFile

  For Each ProjectFile In Me.Project.ProjectFiles
    ProjectFile.AddTab(Tabs, FirstTab)
    FirstTab = False
    Tabs.Show
  Next

End

Public Sub Form_Close()

  Project.Save()
  Project.ProjectFiles = Null
  Quit

End

Public Sub FileOpen_Click()

End

Public Sub FileSave_Click()

  Project.Save()

End

Public Sub RunMenu_Click()

  Project.Run()

End

Public Sub Form_Deactivate()

  Me.CodeCompleter.Pulldown()

End

Public Sub Form_Move()

  Me.CodeCompleter.Pulldown()
  FormSettings.SaveLocationAndSize(Me)

End

Public Sub Form_Resize()

  Me.CodeCompleter.Pulldown()
  FormSettings.SaveLocationAndSize(Me)

End

Public Sub Tabs_Close(Index As Integer)

  Dim Control As Control
  Dim IsLast As Boolean = Tabs.Count = 1

  With Tabs[Index]
    For Each Control In .Children
      Try Object.Call(Control, "Flush")
    Next
    .Children.Clear
    .Tag = Null
    .Delete
  End With

  If IsLast Then
    Tabs.Hide
    FirstTab = True
  Endif

End

Public Sub Tabs_CloseAll()

  Dim Index As Integer

  For Index = 0 To Tabs.Count - 1
    Tabs_Close(0)
  Next

End

Public Sub MenuDebug_Click()

  Me.Project.Debug()

End

Public Sub MenuDebugContinue_Click()

  Try Me.Project.Debugger.Continue()

End

Public Sub MenuDebugStop_Click()

  Try Me.Project.Debugger.Exit()

End

Public Sub MenuDebugStepIn_Click()

  Try Me.Project.Debugger.StepIn()

End

Public Sub MenuDebugStepOver_Click()

  Try Me.Project.Debugger.StepOver()

End

Public Sub MenuDebugStepOut_Click()

  Try Me.Project.Debugger.StepOut()

End

Public Sub MenuDebugStepInstruction_Click()

  Try Me.Project.Debugger.StepInstruction()

End

Public Sub MenuDebugStepOverInstruction_Click()

  Try Me.Project.Debugger.StepOverInstruction()

End

Public Sub MenuRefresh_Click()

  Try Me.Project.Debugger.Refresh()

End

Public Sub MenuAbout_Click()

  Dim x As Integer

  ' For x = 1 To 10
  '   CommandText.Text &= "Line" & x & "\n"
  ' Next
  '
  ' CommandText.EnsureVisible()

  For x = 1 To 10
    Me.Project.Display("Line" & x)
  Next

End

Public Sub Project_DisplayLineOfText(Value As String)

  CommandText.Text &= Value & "\n"
  CommandText.EnsureVisible()
  Wait

End

Public Sub Project_ShowFile(ProjectFile As ProjectFile)

  Dim Tab As Control
  Dim Index As Integer
  Dim IsOpen As Boolean

  For Index = 0 To Tabs.Count - 1
    Tab = Tabs[Index]
    If Not IsNull(Tab.Tag) And If Tab.Tag = ProjectFile Then
      Tabs.Index = Index
      IsOpen = True
      Break
    Endif
  Next

  If Not IsOpen Then
    ProjectFile.AddTab(Tabs, FirstTab)
    Tabs.Index = Tabs.Count - 1
    FirstTab = False
    Tabs.Show
  Endif

End

Public Sub Project_CodeCompletionPopup(_TextEditor As CodeEditor)

  Me.CodeCompleter.Popup(Me, _TextEditor)

End

Public Sub Project_CodeCompletionPulldown(InsertFirst As Boolean)

  Me.CodeCompleter.Pulldown(InsertFirst)

End

Public Sub Project_CodeCompletionNavigate(Down As Integer)

  If Me.CodeCompleter.Navigate(Down)
    Stop Event
  End If

End
